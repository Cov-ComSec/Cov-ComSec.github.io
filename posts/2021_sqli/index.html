<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=robots content="noodp"><meta http-equiv=x-ua-compatible content="IE=edge, chrome=1"><title>SQL Injection - CUEH ComSec</title><meta name=Description content="An introductory session into SQL Injection"><meta property="og:title" content="SQL Injection"><meta property="og:description" content="An introductory session into SQL Injection"><meta property="og:type" content="article"><meta property="og:url" content="https://cov-comsec.github.io/posts/2021_sqli/"><meta property="og:image" content="https://cov-comsec.github.io/logo.svg"><meta property="article:section" content="posts"><meta property="article:published_time" content="2022-03-02T12:40:28+01:00"><meta property="article:modified_time" content="2022-04-22T10:54:49+01:00"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://cov-comsec.github.io/logo.svg"><meta name=twitter:title content="SQL Injection"><meta name=twitter:description content="An introductory session into SQL Injection"><meta name=application-name content="CUEH ComSec"><meta name=apple-mobile-web-app-title content="CUEH ComSec"><meta name=theme-color content="#ffffff"><meta name=msapplication-TileColor content="#da532c"><link rel=icon href=/CUEH.svg><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=mask-icon href=/safari-pinned-tab.svg color=#5bbad5><link rel=manifest href=/site.webmanifest><link rel=canonical href=https://cov-comsec.github.io/posts/2021_sqli/><link rel=prev href=https://cov-comsec.github.io/posts/2022_race_conditions/><link rel=stylesheet href=/lib/normalize/normalize.min.css><link rel=stylesheet href=/css/style.min.css><link rel=stylesheet href=/lib/fontawesome-free/all.min.css><link rel=stylesheet href=/lib/animate/animate.min.css><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","headline":"SQL Injection","inLanguage":"en","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/cov-comsec.github.io\/posts\/2021_sqli\/"},"image":["https:\/\/cov-comsec.github.io\/CUEH.svg"],"genre":"posts","keywords":"SQLi, TryHackMe, OWASP, web","wordcount":663,"url":"https:\/\/cov-comsec.github.io\/posts\/2021_sqli\/","datePublished":"2022-03-02T12:40:28+01:00","dateModified":"2022-04-22T10:54:49+01:00","publisher":{"@type":"Organization","name":"Jack Orcherton","logo":"https:\/\/cov-comsec.github.io\/CUEH.svg"},"author":{"@type":"Person","name":"Jack Orcherton"},"description":"An introductory session into SQL Injection"}</script></head><body header-desktop=fixed header-mobile=auto><script type=text/javascript>(window.localStorage&&localStorage.getItem("theme")?localStorage.getItem("theme")==="dark":"dark"==="auto"?window.matchMedia("(prefers-color-scheme: dark)").matches:"dark"==="dark")&&document.body.setAttribute("theme","dark")</script><div id=mask></div><div class=wrapper><header class=desktop id=header-desktop><div class=header-wrapper><div class=header-title><a href=/ title="CUEH ComSec"><img class="lazyload logo" src=/svg/loading.min.svg data-src=/CUEH.svg data-srcset="/CUEH.svg, /CUEH.svg 1.5x, /CUEH.svg 2x" data-sizes=auto alt=/CUEH.svg title=/CUEH.svg>ComSec</a></div><div class=menu><div class=menu-inner><a class=menu-item href=/about/>About </a><a class=menu-item href=/posts/>Posts </a><a class=menu-item href=/tags/>Tags </a><a class=menu-item href=/categories/>Categories </a><a class=menu-item href=https://cueh-comsec.ctfd.io/ rel="noopener noreffer" target=_blank>CTFd </a><span class="menu-item delimiter"></span><span class="menu-item search" id=search-desktop>
<input type=text placeholder="Search titles or contents..." id=search-input-desktop>
<a href=javascript:void(0); class="search-button search-toggle" id=search-toggle-desktop title=Search><i class="fas fa-search fa-fw"></i></a>
<a href=javascript:void(0); class="search-button search-clear" id=search-clear-desktop title=Clear><i class="fas fa-times-circle fa-fw"></i></a>
<span class="search-button search-loading" id=search-loading-desktop><i class="fas fa-spinner fa-fw fa-spin"></i></span>
</span><a href=javascript:void(0); class="menu-item theme-switch" title="Switch Theme"><i class="fas fa-adjust fa-fw"></i></a></div></div></div></header><header class=mobile id=header-mobile><div class=header-container><div class=header-wrapper><div class=header-title><a href=/ title="CUEH ComSec"><img class="lazyload logo" src=/svg/loading.min.svg data-src=/CUEH.svg data-srcset="/CUEH.svg, /CUEH.svg 1.5x, /CUEH.svg 2x" data-sizes=auto alt=/CUEH.svg title=/CUEH.svg>ComSec</a></div><div class=menu-toggle id=menu-toggle-mobile><span></span><span></span><span></span></div></div><div class=menu id=menu-mobile><div class=search-wrapper><div class="search mobile" id=search-mobile><input type=text placeholder="Search titles or contents..." id=search-input-mobile>
<a href=javascript:void(0); class="search-button search-toggle" id=search-toggle-mobile title=Search><i class="fas fa-search fa-fw"></i></a>
<a href=javascript:void(0); class="search-button search-clear" id=search-clear-mobile title=Clear><i class="fas fa-times-circle fa-fw"></i></a>
<span class="search-button search-loading" id=search-loading-mobile><i class="fas fa-spinner fa-fw fa-spin"></i></span></div><a href=javascript:void(0); class=search-cancel id=search-cancel-mobile>Cancel</a></div><a class=menu-item href=/about/ title>About</a><a class=menu-item href=/posts/ title>Posts</a><a class=menu-item href=/tags/ title>Tags</a><a class=menu-item href=/categories/ title>Categories</a><a class=menu-item href=https://cueh-comsec.ctfd.io/ title rel="noopener noreffer" target=_blank>CTFd</a><a href=javascript:void(0); class="menu-item theme-switch" title="Switch Theme">
<i class="fas fa-adjust fa-fw"></i></a></div></div></header><div class="search-dropdown desktop"><div id=search-dropdown-desktop></div></div><div class="search-dropdown mobile"><div id=search-dropdown-mobile></div></div><main class=main><div class=container><div class=toc id=toc-auto><h2 class=toc-title>Contents</h2><div class=toc-content id=toc-content-auto></div></div><article class="page single"><h1 class="single-title animated flipInX">SQL Injection</h1><div class=post-meta><div class=post-meta-line><span class=post-author><a href=https://jackorcherton.github.io title=Author target=_blank rel="noopener noreffer author" class=author><i class="fas fa-user-circle fa-fw"></i>Jack Orcherton</a></span>&nbsp;<span class=post-category>included in <a href=/categories/academic-year-2021-22/><i class="far fa-folder fa-fw"></i>Academic Year 2021-22</a></span></div><div class=post-meta-line><i class="far fa-calendar-alt fa-fw"></i>&nbsp;<time datetime=2022-03-02>2022-03-02</time>&nbsp;<i class="fas fa-pencil-alt fa-fw"></i>&nbsp;663 words&nbsp;
<i class="far fa-clock fa-fw"></i>&nbsp;4 minutes&nbsp;</div></div><div class="details toc" id=toc-static kept=true><div class="details-summary toc-title"><span>Contents</span>
<span><i class="details-icon fas fa-angle-right"></i></span></div><div class="details-content toc-content" id=toc-content-static><nav id=TableOfContents><ul><li><a href=#sql>SQL</a></li><li><a href=#sql-example>SQL Example</a></li><li><a href=#injection-attacks>Injection Attacks</a></li><li><a href=#sql-injections>SQL Injections</a></li><li><a href=#a-bad-demo>A Bad Demo</a></li><li><a href=#can-you-secure-it>Can you secure it?</a></li><li><a href=#how-am-i-meant-to-remember-the-commands>How am I meant to remember the commands?</a></li><li><a href=#if-it-is-that-easy>If it is that easy&mldr;</a></li><li><a href=#more-advanced-sqli>More Advanced SQLi</a></li><li><a href=#nosql-no-problem>NoSQL, no problem?</a></li><li><a href=#prevent-sqli>Prevent SQLi</a></li><li><a href=#todays-task>Today&rsquo;s Task</a></li></ul></nav></div></div><div class=content id=content><h1 id=sql-injection>SQL Injection</h1><ul><li>Further on today, we will be using THM</li><li>If you haven&rsquo;t registered go to <a href=https://tryhackme.com target=_blank rel="noopener noreffer">tryhackme.com</a></li><li>Ensure you have the <a href=https://tryhackme.com/access target=_blank rel="noopener noreffer">VPN file</a> or AttackBox ready</li></ul><h2 id=sql>SQL</h2><p>Structured Query Language (SQL) is used to communicate with databases and has the capability to delete, edit, insert or retrieve data. There are a few variations of SQL which have some slight syntactical differences. A few examples are MySQL, SQL Server and SQLite.</p><div class="details admonition question open"><div class="details-summary admonition-title"><i class="icon fas fa-question-circle fa-fw"></i>Question<i class="details-icon fas fa-angle-right fa-fw"></i></div><div class=details-content><div class=admonition-content>Can you think where databases are used on the web?</div></div></div><h2 id=sql-example>SQL Example</h2><p>What will this do?</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>SELECT</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=n>Customers</span><span class=w> </span><span class=k>WHERE</span><span class=w> </span><span class=n>Firstname</span><span class=o>=</span><span class=s2>&#34;Jack&#34;</span><span class=p>;</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><div class="details admonition tip"><div class="details-summary admonition-title"><i class="icon fas fa-lightbulb fa-fw"></i>Answer<i class="details-icon fas fa-angle-right fa-fw"></i></div><div class=details-content><div class=admonition-content>It will search the table customers and will return all the people with the first name &ldquo;Jack&rdquo;.</div></div></div><h2 id=injection-attacks>Injection Attacks</h2><p>An injection attack is where a user can trick a server to run a command, via vectors such as an input, header or URL. It is currently in the third position of the <a href=https://owasp.org/Top10/ target=_blank rel="noopener noreffer">OWASP Top 10</a>.</p><p>The main cause of an injection attack is down to improper user input sanitisation and or validation.</p><div class="details admonition note"><div class="details-summary admonition-title"><i class="icon fas fa-pencil-alt fa-fw"></i>Note<i class="details-icon fas fa-angle-right fa-fw"></i></div><div class=details-content><div class=admonition-content>This does not only include SQL injection, other forms include:
- XSS
- OS Command Injection</div></div></div><h2 id=sql-injections>SQL Injections</h2><p>SQL injection, sometimes shortened to SQLi, is where you are able to insert commands that are able to effect or retrieve information from databases. It is regularly found on dynamic sites; with WordPress plugins being frequently affected (see <a href="https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2022-25607" target=_blank rel="noopener noreffer">CVE-2022-25607</a> for an example).</p><div class="details admonition info open"><div class="details-summary admonition-title"><i class="icon fas fa-info-circle fa-fw"></i>Info<i class="details-icon fas fa-angle-right fa-fw"></i></div><div class=details-content><div class=admonition-content><a href=https://www.darkreading.com/attacks-breaches/sql-injection-attacks-represent-two-third-of-all-web-app-attacks target=_blank rel="noopener noreffer">Akamai</a> observed, between 2017-2019, 65.1% of attacks on web applications used SQLi.</div></div></div><h2 id=a-bad-demo>A Bad Demo</h2><p>Can you spot/exploit the flaw?</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-py data-lang=py><span class=line><span class=cl><span class=n>user</span><span class=o>=</span><span class=nb>input</span><span class=p>(</span><span class=s2>&#34;Enter Username: &#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>password</span><span class=o>=</span><span class=nb>input</span><span class=p>(</span><span class=s2>&#34;Enter Password: &#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>sql</span> <span class=o>=</span> <span class=s1>&#39;SELECT * FROM users WHERE user==&#34;&#39;</span><span class=o>+</span><span class=n>user</span><span class=o>+</span><span class=s1>&#39;&#34;AND password==&#34;&#39;</span><span class=o>+</span><span class=n>password</span><span class=o>+</span><span class=s1>&#39;&#34;;&#39;</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=s2>&#34;SQL Command Sent: &#34;</span><span class=p>,</span> <span class=n>sql</span><span class=p>,</span> <span class=s2>&#34;</span><span class=se>\n</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>cursor</span><span class=o>.</span><span class=n>execute</span><span class=p>(</span><span class=n>sql</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>user</span><span class=o>=</span><span class=n>cursor</span><span class=o>.</span><span class=n>fetchall</span><span class=p>()</span>
</span></span></code></pre></td></tr></table></div></div><div class="details admonition tip"><div class="details-summary admonition-title"><i class="icon fas fa-lightbulb fa-fw"></i>How To<i class="details-icon fas fa-angle-right fa-fw"></i></div><div class=details-content><div class=admonition-content><p>" OR 1=1; &ndash;</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-py data-lang=py><span class=line><span class=cl><span class=s1>&#39;SELECT * FROM users WHERE user==&#34;&#39;</span><span class=o>+</span><span class=n>user</span><span class=o>+</span><span class=s1>&#39;&#34;AND password==&#34;&#39;</span><span class=o>+</span> <span class=n>password</span><span class=o>+</span><span class=s1>&#39;&#34;;&#39;</span>
</span></span></code></pre></td></tr></table></div></div><p>Becomes:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>SELECT</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=k>user</span><span class=w> </span><span class=k>WHERE</span><span class=w> </span><span class=k>user</span><span class=o>==</span><span class=s2>&#34;Jack&#34;</span><span class=w> </span><span class=k>AND</span><span class=w> </span><span class=n>password</span><span class=o>==</span><span class=s2>&#34;&#34;</span><span class=w> </span><span class=k>OR</span><span class=w> </span><span class=mi>1</span><span class=o>=</span><span class=mi>1</span><span class=p>;</span><span class=w> </span><span class=c1>--&#34;;
</span></span></span></code></pre></td></tr></table></div></div><p>The command ends the string then compares 1 with 1 (which equals true) and &ldquo;&ndash;&rdquo; comments out the rest of the statement. In this case, the whole table would be printed.</p></div></div></div><h2 id=can-you-secure-it>Can you secure it?</h2><ul><li>Research ways that you can secure the program and implement it.</li></ul><div class="details admonition tip"><div class="details-summary admonition-title"><i class="icon fas fa-lightbulb fa-fw"></i>How To<i class="details-icon fas fa-angle-right fa-fw"></i></div><div class=details-content><div class=admonition-content><ul><li>Input validation</li><li>Use ? placeholder</li><li>Use the fetchone method - this does not secure it, but makes exploitation much easier</li></ul></div></div></div><h2 id=how-am-i-meant-to-remember-the-commands>How am I meant to remember the commands?</h2><p>Thankfully you can use a tool named SQLmap, here is a useful <a href=https://thedarksource.com/sqlmap-cheat-sheet/ target=_blank rel="noopener noreffer">SQLmap Cheatsheet</a>.</p><p>It is also possible to pair with Burpsuite, to save having specify location. To do this, intercept the request, then save it to a file and use the following command:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>sqlmap -r filename
</span></span></code></pre></td></tr></table></div></div><h2 id=if-it-is-that-easy>If it is that easy&mldr;</h2><p>If it is that easy, why is it so common? Well, many applications are written in PHP which didn&rsquo;t originally contain a SQL validation method. This has meant that many have ignored it. The main problem now is that many insecure code examples exist on code forums/sites.</p><p>Another factor is the use of content management systems. This is because if the underlying system is affected, every website using that platform will be vulnerable. However, this can be a benefit, as it will mean that the code only needs to be updated in one place.</p><h2 id=more-advanced-sqli>More Advanced SQLi</h2><ul><li><strong>Time-based/Blind</strong> - Sometimes you cannot see the output, therefore, you can use timers to show your answer.</li><li><strong>Boolean</strong> - It is possible to infer the content inside a database using boolean operators, such as changing the order the way data is displayed to the user based depending on whether a comparison is true.</li></ul><h2 id=nosql-no-problem>NoSQL, no problem?</h2><ul><li>Some people believe that no-SQL is injection free, but this is false.</li><li>NoSQL stands for non-relational SQL.</li><li>Although the syntax is different it is still exploitable.</li><li><a href=https://book.hacktricks.xyz/pentesting-web/nosql-injection target=_blank rel="noopener noreffer">Cheat Sheet</a>.</li></ul><h2 id=prevent-sqli>Prevent SQLi</h2><ul><li>Switch to a static site, like Hugo.<ul><li>but you lose some functionality (e.g. forms).</li><li>Not as beginner friendly.</li></ul></li><li>If you use a CMS, install the bare-minimum of plugins (and only ones from trusted sources).</li><li>Pentest the site!</li></ul><h2 id=todays-task>Today&rsquo;s Task</h2><ul><li>Use THM search function and complete:<ul><li><a href=https://tryhackme.com/room/sqlilab target=_blank rel="noopener noreffer">sqlilab</a></li><li><a href=https://tryhackme.com/room/sqlinjectionlm target=_blank rel="noopener noreffer">sqlinjectionlm</a></li><li><a href=https://tryhackme.com/room/dailybugle target=_blank rel="noopener noreffer">dailybugle</a></li><li>(organised in terms of difficulty)</li></ul></li><li>ask below if you have any questions.</li></ul></div><div class=post-footer id=post-footer><div class=post-info><div class=post-info-line><div class=post-info-mod><span>Updated on 2022-04-22&nbsp;<a class=git-hash href=https://github.com/Cov-ComSec/Cov-ComSec.github.io/commit/816cde16bcf0bdf97981423521ef21f96a37d2a4 target=_blank title="commit by Jack Orcherton(31766070+jackorcherton@users.noreply.github.com) 816cde16bcf0bdf97981423521ef21f96a37d2a4: Missed a heading">
<i class="fas fa-hashtag fa-fw"></i>816cde1</a></span></div><div class=post-info-license></div></div><div class=post-info-line><div class=post-info-md><span><a class=link-to-markdown href=/posts/2021_sqli/index.md target=_blank>Read Markdown</a></span></div><div class=post-info-share><span></span></div></div></div><div class=post-info-more><section class=post-tags><i class="fas fa-tags fa-fw"></i>&nbsp;<a href=/tags/sqli/>SQLi</a>,&nbsp;<a href=/tags/tryhackme/>TryHackMe</a>,&nbsp;<a href=/tags/owasp/>OWASP</a>,&nbsp;<a href=/tags/web/>web</a></section><section><span><a href=javascript:void(0); onclick=window.history.back()>Back</a></span>&nbsp;|&nbsp;<span><a href=/>Home</a></span></section></div><div class=post-nav><a href=/posts/2022_race_conditions/ class=prev rel=prev title="Exploiting Race Conditions"><i class="fas fa-angle-left fa-fw"></i>Exploiting Race Conditions</a></div></div><div id=comments><div id=utterances></div><noscript>Please enable JavaScript to view the comments powered by <a href=https://utteranc.es/>Utterances</a>.</noscript></div></article></div></main><footer class=footer><div class=footer-container><div class=footer-line><i class="far fa-copyright fa-fw"></i><span itemprop=copyrightYear>2020 - 2022</span><span class=author itemprop=copyrightHolder>&nbsp;<a href=/ target=_blank>CUEH ComSec</a></span></div></div></footer></div><div id=fixed-buttons><a href=# id=back-to-top class=fixed-button title="Back to Top"><i class="fas fa-arrow-up fa-fw"></i>
</a><a href=# id=view-comments class=fixed-button title="View Comments"><i class="fas fa-comment fa-fw"></i></a></div><script type=text/javascript src=/lib/smooth-scroll/smooth-scroll.min.js></script><script type=text/javascript src=/lib/autocomplete/autocomplete.min.js></script><script type=text/javascript src=/lib/lunr/lunr.min.js></script><script type=text/javascript src=/lib/lazysizes/lazysizes.min.js></script><script type=text/javascript src=/lib/clipboard/clipboard.min.js></script><script type=text/javascript>window.config={code:{copyTitle:"Copy to clipboard",maxShownLines:10},comment:{utterances:{darkTheme:"photon-dark",issueTerm:"pathname",label:"Comments",lightTheme:"github-light",repo:"Cov-ComSec/Cov-ComSec.github.io"}},search:{highlightTag:"em",lunrIndexURL:"/index.json",maxResultLength:10,noResultsFound:"No results found",snippetLength:30,type:"lunr"}}</script><script type=text/javascript src=/js/theme.min.js></script></body></html>